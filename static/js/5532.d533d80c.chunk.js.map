{"version":3,"file":"static/js/5532.d533d80c.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/layers/graphics/sources/support/uploads.js","../node_modules/@arcgis/core/layers/graphics/sources/support/uploadAssets.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport e from\"../../../../request.js\";import{throwIfAborted as t}from\"../../../../core/promiseUtils.js\";import{join as o}from\"../../../../core/urlUtils.js\";import{isHostedAgolService as s}from\"../../../support/arcgisLayerUrl.js\";const r=1e6,a=20*r,n=2e9,i=3;async function p({data:p,name:c,description:l},m,d){let f=null;try{const u=o(m,\"uploads\"),h=o(u,\"info\"),{data:w}=await e(h,{query:{f:\"json\"},responseType:\"json\"});t(d);const y=s(m),j=w.maxUploadFileSize*r,g=y?n:j,q=y?Math.min(a,j):a;if(p.size>g)throw new Error(\"Data too large\");const T=o(u,\"register\"),{data:z}=await e(T,{query:{f:\"json\",itemName:c,description:l},responseType:\"json\",method:\"post\"});if(t(d),!z.success)throw new Error(\"Registration failed\");const{itemID:E}=z.item;f=o(u,E);const U=o(f,\"uploadPart\"),D=Math.ceil(p.size/q),M=new Array;for(let e=0;e<D;++e)M.push(p.slice(e*q,Math.min((e+1)*q,p.size)));const P=M.slice().reverse(),x=new Array,A=async()=>{for(;0!==P.length;){const o=M.length-P.length,s=P.pop(),r=new FormData;r.append(\"f\",\"json\"),r.append(\"file\",s),r.append(\"partId\",`${o}`);const{data:a}=await e(U,{timeout:0,body:r,responseType:\"json\",method:\"post\"});if(t(d),!a.success)throw new Error(\"Part upload failed\")}};for(let e=0;e<i&&0!==P.length;++e)x.push(A());await Promise.all(x);const F=o(f,\"commit\"),{data:I}=await e(F,{query:{f:\"json\",parts:M.map(((e,t)=>t)).join(\",\")},responseType:\"json\",method:\"post\"});if(t(d),!I.success)throw new Error(\"Commit failed\");return I.item}catch(u){if(null!=f){const t=o(f,\"delete\");await e(t,{query:{f:\"json\"},responseType:\"json\",method:\"post\"})}throw u}}export{p as uploadItem};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport e from\"../../../../request.js\";import t from\"../../../../core/Error.js\";import s from\"../../../../core/Logger.js\";import{throwIfAborted as r,throwIfAbortError as a,after as o}from\"../../../../core/promiseUtils.js\";import{parseData as n,join as i}from\"../../../../core/urlUtils.js\";import{generateBracedUUID as u}from\"../../../../core/uuid.js\";import{externalIsOnService as l,assetFormatId as c,ServiceAsset as p,ServiceAssetPart as f,externalSourceToMultiPart as d}from\"../../../../geometry/support/meshUtils/External.js\";import{uploadItem as m}from\"./uploads.js\";import{getFormatIdMimeType as y,getMimeTypeFormatId as w,getFilenameFormatId as h}from\"../../../support/infoFor3D.js\";async function g(e,t,s){return e.length?Promise.all(e.map((e=>T(e,t,s)))):[]}async function T(e,{layer:s,ongoingUploads:r},a){const o=r.get(e);if(o)return o;if(!P(s))throw new t(`${s.type}-layer:upload-failure`,\"Layer does not support asset uploads.\",new Error);if(b(e,s))return e;const n=E(e,s,a);r.set(e,n);try{await n}finally{r.delete(e)}return e}function b(e,t){const{parsedUrl:s}=t;return null!=s&&e.metadata.externalSources.some((e=>l(e,s)))}async function E(e,t,s){const{metadata:a}=e,{displaySource:o}=a,n=x(o?.source,t),i=!!n,u=a.externalSources.length>0,l=i?$(n,t,s):u?F(e,t,s):j(e,t,s),c=await l;return r(s),e.addExternalSources([c]),e}async function $(e,t,s){return{source:await N(e,t,s),original:!0}}async function F(e,s,r){const a=B(s),{externalSources:o}=e.metadata,n=U(o,s);if(!n)throw new t(`${s.type}-layer:upload-failure`,\"Could not find an external source that is supported by the service.\",new Error);const i=await N(n,s,r);e.addExternalSources([{source:i,original:!0}]);return{source:await q(i,s,a)}}async function j(e,t,s){const r=D(e,t,s);return{source:await A([r],t,s),extent:e.extent.clone(),original:!0}}async function D(e,t,s){const a=B(t),o=await e.load(s),n=await o.toBinaryGLTF({ignoreLocalTransform:!0});r(s);const i=await n.buffer();return r(s),{blob:new Blob([i.data],{type:i.type}),assetName:`${u()}.glb`,assetType:a}}function U(e,t){for(const s of e){const e=x(s.source,t);if(e)return e}return null}function x(e,t){if(!e)return null;const{infoFor3D:{supportedFormats:s,editFormats:r}}=t,a=d(e),o=new Array;let n=!1;for(let i=0;i<a.length;++i){const e=v(a[i],s);if(!e)return null;r.includes(e.assetType)&&(n=!0),o.push(e)}return n?o:null}function v(e,t){const s=c(e,t);return s?{asset:e,assetType:s}:null}async function N(e,t,s){return A(e.map((e=>S(e,s))),t,s)}async function A(e,t,s){const a=await Promise.all(e.map((async e=>{const a=I(await e,t,s);return r(s),a})));r(s);const{uploadResults:o}=await R(a.map((({item:e})=>e)),t,s);return r(s),e.map(((e,s)=>L(a[s],o[s],t)))}async function S(e,t){const{asset:s,assetType:a}=e;if(s instanceof File)return{blob:s,assetName:s.name,assetType:a};const o=await s.toBlob(t);return r(t),{blob:o,assetName:s.assetName,assetType:a}}async function I(e,o,i){const{blob:u,assetType:l,assetName:c}=e;let p=null;try{const e=await m({data:u,name:c},o.url,i);r(i),p={assetType:l,assetUploadId:e.itemID}}catch(f){a(f),s.getLogger(\"esri.layers.graphics.sources.support.uploadAssets\").warnOnce(`Service ${o.url} does not support the REST Uploads API.`)}if(!p){const e=await n(u);if(r(i),!e.isBase64)throw new t(`${o.type}-layer:uploadAssets-failure`,\"Expected gltf data in base64 format after conversion.\",new Error);p={assetType:l,assetData:e.data}}if(!p)throw new t(`${o.type}-layer:uploadAssets-failure`,\"Unable to prepare uploadAsset request options.\",new Error);return{item:p,assetName:c}}async function R(s,a,o){const n=await e(i(a.parsedUrl.path,\"uploadAssets\"),{timeout:0,query:{f:\"json\",assets:JSON.stringify(s)},method:\"post\",responseType:\"json\"});if(r(o),n.data.uploadResults.length!==s.length)throw new t(`${a.type}-layer:uploadAssets-failure`,`Bad response. Uploaded ${s.length} items and received ${n.data.uploadResults.length} results.`,new Error);return n.data}function L(e,s,r){const{success:a}=s;if(!a){const{error:a}=s;throw new t(`${r.type}-layer:upload-failure`,`Failed to upload mesh file ${e.assetName}. Error code: ${a.code}. Error message: ${a.messages}`,new Error)}const{assetHash:o}=s,{assetName:n,item:{assetType:i}}=e,{infoFor3D:{supportedFormats:u}}=r,l=y(i,u);if(!l)throw new t(`${r.type}-layer:upload-failure`,`The service allowed us to upload an asset of FormatID ${i}, but it does not list it in its supported formats.`,new Error);return new p(n,l,[new f(`${r.parsedUrl.path}/assets/${o}`,o)])}async function q(s,r,a){const o=s.map((({assetName:e,parts:t})=>({assetName:e,assetHash:t[0].partHash}))),n=r.capabilities?.operations.supportsAsyncConvert3D,u={query:{f:\"json\",assets:JSON.stringify(o),transportType:\"esriTransportTypeUrl\",targetFormat:a,async:n},responseType:\"json\",timeout:0},l=i(r.parsedUrl.path,\"convert3D\"),c=(n?await C(l,u):await e(l,u)).data,{infoFor3D:{supportedFormats:d}}=r;return c.assets.map((e=>{const s=w(e.contentType,d);if(!s)throw new t(`${r.type}-layer:upload-failure`,`The service allowed us to upload an asset of FormatID ${s}, but it does not list it in its supported formats.`,new Error);return new p(e.assetName,e.contentType,[new f(e.assetURL,e.assetHash)])}))}async function C(s,r){const a=(await e(s,r)).data.statusUrl;for(;;){const s=(await e(a,{query:{f:\"json\"},responseType:\"json\"})).data;switch(s.status){case\"Completed\":return e(s.resultUrl,{query:{f:\"json\"},responseType:\"json\"});case\"CompletedWithErrors\":throw new t(\"async-convert3D-failed\",\"asynchronous convert3D call failed.\");case\"Failed ImportChanges\":case\"InProgress\":case\"Pending\":case\"ExportAttachments\":case\"ExportChanges\":case\"ExportingData\":case\"ExportingSnapshot\":case\"ImportAttachments\":case\"ProvisioningReplica\":case\"UnRegisteringReplica\":break;default:throw new t(\"async-convert3D-failed\",\"asynchronous convert3D call failed (undefined response status)\")}await o(H)}}function P(e){return!!e.infoFor3D&&!!e.url}function B(e){const{infoFor3D:s}=e,r=w(\"model/gltf-binary\",s.supportedFormats)??h(\"glb\",s.supportedFormats);if(!r)throw new t(`${e.type}-layer:upload-failure`,\"Layer does not support glb.\",new Error);return r}const H=1e3;export{g as uploadAssets};\n"],"names":["r","a","n","p","m","d","data","c","name","l","description","f","u","o","h","e","query","responseType","w","t","y","s","j","maxUploadFileSize","g","q","Math","min","size","Error","T","itemName","method","z","success","E","item","itemID","U","D","ceil","M","Array","push","slice","P","reverse","x","A","length","pop","FormData","append","timeout","body","Promise","all","F","parts","map","join","I","layer","ongoingUploads","get","type","b","set","delete","parsedUrl","metadata","externalSources","some","displaySource","source","i","$","addExternalSources","N","original","B","extent","clone","load","toBinaryGLTF","ignoreLocalTransform","buffer","blob","Blob","assetName","assetType","infoFor3D","supportedFormats","editFormats","v","includes","asset","S","R","uploadResults","L","File","toBlob","url","assetUploadId","warnOnce","isBase64","assetData","path","assets","JSON","stringify","error","code","messages","assetHash","partHash","capabilities","operations","supportsAsyncConvert3D","transportType","targetFormat","async","C","contentType","assetURL","statusUrl","status","resultUrl","H"],"sourceRoot":""}