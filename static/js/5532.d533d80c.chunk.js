"use strict";(self.webpackChunkjakartasatubeta=self.webpackChunkjakartasatubeta||[]).push([[5532],{25532:function(e,t,r){r.r(t),r.d(t,{uploadAssets:function(){return b}});var n=r(74165),a=r(37762),s=r(15861),o=r(76200),u=r(10064),c=r(32718),p=r(66978),i=r(35995),l=r(71907),f=r(17493),d=r(25899),h=1e6,y=20*h,m=2e9;function w(e,t,r){return v.apply(this,arguments)}function v(){return v=(0,s.Z)((0,n.Z)().mark((function e(t,r,a){var u,c,l,f,w,v,x,b,Z,k,g,T,E,_,j,F,D,U,A,N,S,C,I,P,L,R,q,z;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.data,c=t.name,l=t.description,f=null,e.prev=2,w=(0,i.v_)(r,"uploads"),v=(0,i.v_)(w,"info"),e.next=7,(0,o.default)(v,{query:{f:"json"},responseType:"json"});case 7:if(x=e.sent,b=x.data,(0,p.k_)(a),Z=(0,d.M8)(r),k=b.maxUploadFileSize*h,g=Z?m:k,T=Z?Math.min(y,k):y,!(u.size>g)){e.next=13;break}throw new Error("Data too large");case 13:return E=(0,i.v_)(w,"register"),e.next=16,(0,o.default)(E,{query:{f:"json",itemName:c,description:l},responseType:"json",method:"post"});case 16:if(_=e.sent,j=_.data,(0,p.k_)(a),j.success){e.next=20;break}throw new Error("Registration failed");case 20:for(F=j.item.itemID,f=(0,i.v_)(w,F),D=(0,i.v_)(f,"uploadPart"),U=Math.ceil(u.size/T),A=new Array,N=0;N<U;++N)A.push(u.slice(N*T,Math.min((N+1)*T,u.size)));for(S=A.slice().reverse(),C=new Array,I=function(){var e=(0,s.Z)((0,n.Z)().mark((function e(){var t,r,s,u,c;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===S.length){e.next=11;break}return t=A.length-S.length,r=S.pop(),(s=new FormData).append("f","json"),s.append("file",r),s.append("partId","".concat(t)),e.next=5,(0,o.default)(D,{timeout:0,body:s,responseType:"json",method:"post"});case 5:if(u=e.sent,c=u.data,(0,p.k_)(a),c.success){e.next=9;break}throw new Error("Part upload failed");case 9:e.next=0;break;case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=0;P<3&&0!==S.length;++P)C.push(I());return e.next=28,Promise.all(C);case 28:return L=(0,i.v_)(f,"commit"),e.next=31,(0,o.default)(L,{query:{f:"json",parts:A.map((function(e,t){return t})).join(",")},responseType:"json",method:"post"});case 31:if(R=e.sent,q=R.data,(0,p.k_)(a),q.success){e.next=35;break}throw new Error("Commit failed");case 35:return e.abrupt("return",q.item);case 38:if(e.prev=38,e.t0=e.catch(2),null==f){e.next=44;break}return z=(0,i.v_)(f,"delete"),e.next=44,(0,o.default)(z,{query:{f:"json"},responseType:"json",method:"post"});case 44:throw e.t0;case 45:case"end":return e.stop()}}),e,null,[[2,38]])}))),v.apply(this,arguments)}var x=r(18277);function b(e,t,r){return Z.apply(this,arguments)}function Z(){return(Z=(0,s.Z)((0,n.Z)().mark((function e(t,r,a){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.length?Promise.all(t.map((function(e){return k(e,r,a)}))):[]);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,t,r){return g.apply(this,arguments)}function g(){return g=(0,s.Z)((0,n.Z)().mark((function e(t,r,a){var s,o,c,p;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.layer,o=r.ongoingUploads,!(c=o.get(t))){e.next=4;break}return e.abrupt("return",c);case 4:if($(s)){e.next=6;break}throw new u.Z("".concat(s.type,"-layer:upload-failure"),"Layer does not support asset uploads.",new Error);case 6:if(!T(t,s)){e.next=8;break}return e.abrupt("return",t);case 8:return p=E(t,s,a),o.set(t,p),e.prev=10,e.next=13,p;case 13:return e.prev=13,o.delete(t),e.finish(13);case 16:return e.abrupt("return",t);case 17:case"end":return e.stop()}}),e,null,[[10,,13,16]])}))),g.apply(this,arguments)}function T(e,t){var r=t.parsedUrl;return null!=r&&e.metadata.externalSources.some((function(e){return(0,f.JG)(e,r)}))}function E(e,t,r){return _.apply(this,arguments)}function _(){return _=(0,s.Z)((0,n.Z)().mark((function e(t,r,a){var s,o,u,c,i,l,f;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.metadata,o=s.displaySource,u=P(null===o||void 0===o?void 0:o.source,r),c=!!u,i=s.externalSources.length>0,l=c?j(u,r,a):i?D(t,r,a):A(t,r,a),e.next=8,l;case 8:return f=e.sent,e.abrupt("return",((0,p.k_)(a),t.addExternalSources([f]),t));case 10:case"end":return e.stop()}}),e)}))),_.apply(this,arguments)}function j(e,t,r){return F.apply(this,arguments)}function F(){return(F=(0,s.Z)((0,n.Z)().mark((function e(t,r,a){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R(t,r,a);case 2:return e.t0=e.sent,e.t1=!0,e.abrupt("return",{source:e.t0,original:e.t1});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t,r){return U.apply(this,arguments)}function U(){return U=(0,s.Z)((0,n.Z)().mark((function e(t,r,a){var s,o,c,p;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=ee(r),o=t.metadata.externalSources,c=I(o,r)){e.next=3;break}throw new u.Z("".concat(r.type,"-layer:upload-failure"),"Could not find an external source that is supported by the service.",new Error);case 3:return e.next=5,R(c,r,a);case 5:return p=e.sent,t.addExternalSources([{source:p,original:!0}]),e.next=9,Q(p,r,s);case 9:return e.t0=e.sent,e.abrupt("return",{source:e.t0});case 11:case"end":return e.stop()}}),e)}))),U.apply(this,arguments)}function A(e,t,r){return N.apply(this,arguments)}function N(){return N=(0,s.Z)((0,n.Z)().mark((function e(t,r,a){var s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=S(t,r,a),e.next=3,z([s],r,a);case 3:return e.t0=e.sent,e.t1=t.extent.clone(),e.t2=!0,e.abrupt("return",{source:e.t0,extent:e.t1,original:e.t2});case 7:case"end":return e.stop()}}),e)}))),N.apply(this,arguments)}function S(e,t,r){return C.apply(this,arguments)}function C(){return C=(0,s.Z)((0,n.Z)().mark((function e(t,r,a){var s,o,u,c;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=ee(r),e.next=3,t.load(a);case 3:return o=e.sent,e.next=6,o.toBinaryGLTF({ignoreLocalTransform:!0});case 6:return u=e.sent,(0,p.k_)(a),e.next=10,u.buffer();case 10:return c=e.sent,e.abrupt("return",((0,p.k_)(a),{blob:new Blob([c.data],{type:c.type}),assetName:"".concat((0,l.z)(),".glb"),assetType:s}));case 12:case"end":return e.stop()}}),e)}))),C.apply(this,arguments)}function I(e,t){var r,n=(0,a.Z)(e);try{for(n.s();!(r=n.n()).done;){var s=P(r.value.source,t);if(s)return s}}catch(o){n.e(o)}finally{n.f()}return null}function P(e,t){if(!e)return null;for(var r=t.infoFor3D,n=r.supportedFormats,a=r.editFormats,s=(0,f.zE)(e),o=new Array,u=!1,c=0;c<s.length;++c){var p=L(s[c],n);if(!p)return null;a.includes(p.assetType)&&(u=!0),o.push(p)}return u?o:null}function L(e,t){var r=(0,f.vj)(e,t);return r?{asset:e,assetType:r}:null}function R(e,t,r){return q.apply(this,arguments)}function q(){return(q=(0,s.Z)((0,n.Z)().mark((function e(t,r,a){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",z(t.map((function(e){return H(e,a)})),r,a));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,t,r){return B.apply(this,arguments)}function B(){return B=(0,s.Z)((0,n.Z)().mark((function e(t,r,a){var o,u,c;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map(function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t){var s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=O,e.next=3,t;case 3:return e.t1=e.sent,e.t2=r,e.t3=a,s=(0,e.t0)(e.t1,e.t2,e.t3),e.abrupt("return",((0,p.k_)(a),s));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return o=e.sent,(0,p.k_)(a),e.next=6,G(o.map((function(e){return e.item})),r,a);case 6:return u=e.sent,c=u.uploadResults,e.abrupt("return",((0,p.k_)(a),t.map((function(e,t){return K(o[t],c[t],r)}))));case 9:case"end":return e.stop()}}),e)}))),B.apply(this,arguments)}function H(e,t){return M.apply(this,arguments)}function M(){return M=(0,s.Z)((0,n.Z)().mark((function e(t,r){var a,s,o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.asset,s=t.assetType,!(a instanceof File)){e.next=3;break}return e.abrupt("return",{blob:a,assetName:a.name,assetType:s});case 3:return e.next=5,a.toBlob(r);case 5:return o=e.sent,e.abrupt("return",((0,p.k_)(r),{blob:o,assetName:a.assetName,assetType:s}));case 7:case"end":return e.stop()}}),e)}))),M.apply(this,arguments)}function O(e,t,r){return J.apply(this,arguments)}function J(){return J=(0,s.Z)((0,n.Z)().mark((function e(t,r,a){var s,o,l,f,d,h;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.blob,o=t.assetType,l=t.assetName,f=null,e.prev=2,e.next=5,w({data:s,name:l},r.url,a);case 5:d=e.sent,(0,p.k_)(a),f={assetType:o,assetUploadId:d.itemID},e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),(0,p.r9)(e.t0),c.Z.getLogger("esri.layers.graphics.sources.support.uploadAssets").warnOnce("Service ".concat(r.url," does not support the REST Uploads API."));case 12:if(f){e.next=19;break}return e.next=15,(0,i.IR)(s);case 15:if(h=e.sent,(0,p.k_)(a),h.isBase64){e.next=18;break}throw new u.Z("".concat(r.type,"-layer:uploadAssets-failure"),"Expected gltf data in base64 format after conversion.",new Error);case 18:f={assetType:o,assetData:h.data};case 19:if(f){e.next=21;break}throw new u.Z("".concat(r.type,"-layer:uploadAssets-failure"),"Unable to prepare uploadAsset request options.",new Error);case 21:return e.abrupt("return",{item:f,assetName:l});case 22:case"end":return e.stop()}}),e,null,[[2,9]])}))),J.apply(this,arguments)}function G(e,t,r){return W.apply(this,arguments)}function W(){return W=(0,s.Z)((0,n.Z)().mark((function e(t,r,a){var s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.default)((0,i.v_)(r.parsedUrl.path,"uploadAssets"),{timeout:0,query:{f:"json",assets:JSON.stringify(t)},method:"post",responseType:"json"});case 2:if(s=e.sent,(0,p.k_)(a),s.data.uploadResults.length===t.length){e.next=5;break}throw new u.Z("".concat(r.type,"-layer:uploadAssets-failure"),"Bad response. Uploaded ".concat(t.length," items and received ").concat(s.data.uploadResults.length," results."),new Error);case 5:return e.abrupt("return",s.data);case 6:case"end":return e.stop()}}),e)}))),W.apply(this,arguments)}function K(e,t,r){if(!t.success){var n=t.error;throw new u.Z("".concat(r.type,"-layer:upload-failure"),"Failed to upload mesh file ".concat(e.assetName,". Error code: ").concat(n.code,". Error message: ").concat(n.messages),new Error)}var a=t.assetHash,s=e.assetName,o=e.item.assetType,c=r.infoFor3D.supportedFormats,p=(0,x.d1)(o,c);if(!p)throw new u.Z("".concat(r.type,"-layer:upload-failure"),"The service allowed us to upload an asset of FormatID ".concat(o,", but it does not list it in its supported formats."),new Error);return new f.CP(s,p,[new f.LL("".concat(r.parsedUrl.path,"/assets/").concat(a),a)])}function Q(e,t,r){return V.apply(this,arguments)}function V(){return V=(0,s.Z)((0,n.Z)().mark((function e(t,r,a){var s,c,p,l,d,h,y;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=t.map((function(e){return{assetName:e.assetName,assetHash:e.parts[0].partHash}})),p=null===(s=r.capabilities)||void 0===s?void 0:s.operations.supportsAsyncConvert3D,l={query:{f:"json",assets:JSON.stringify(c),transportType:"esriTransportTypeUrl",targetFormat:a,async:p},responseType:"json",timeout:0},d=(0,i.v_)(r.parsedUrl.path,"convert3D"),!p){e.next=10;break}return e.next=7,X(d,l);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,(0,o.default)(d,l);case 12:e.t0=e.sent;case 13:return h=e.t0.data,y=r.infoFor3D.supportedFormats,e.abrupt("return",h.assets.map((function(e){var t=(0,x.S0)(e.contentType,y);if(!t)throw new u.Z("".concat(r.type,"-layer:upload-failure"),"The service allowed us to upload an asset of FormatID ".concat(t,", but it does not list it in its supported formats."),new Error);return new f.CP(e.assetName,e.contentType,[new f.LL(e.assetURL,e.assetHash)])})));case 16:case"end":return e.stop()}}),e)}))),V.apply(this,arguments)}function X(e,t){return Y.apply(this,arguments)}function Y(){return Y=(0,s.Z)((0,n.Z)().mark((function e(t,r){var a,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.default)(t,r);case 2:a=e.sent.data.statusUrl;case 3:return e.next=5,(0,o.default)(a,{query:{f:"json"},responseType:"json"});case 5:s=e.sent.data,e.t0=s.status,e.next="Completed"===e.t0?9:"CompletedWithErrors"===e.t0?10:"Failed ImportChanges"===e.t0||"InProgress"===e.t0||"Pending"===e.t0||"ExportAttachments"===e.t0||"ExportChanges"===e.t0||"ExportingData"===e.t0||"ExportingSnapshot"===e.t0||"ImportAttachments"===e.t0||"ProvisioningReplica"===e.t0||"UnRegisteringReplica"===e.t0?11:12;break;case 9:return e.abrupt("return",(0,o.default)(s.resultUrl,{query:{f:"json"},responseType:"json"}));case 10:throw new u.Z("async-convert3D-failed","asynchronous convert3D call failed.");case 11:return e.abrupt("break",13);case 12:throw new u.Z("async-convert3D-failed","asynchronous convert3D call failed (undefined response status)");case 13:return e.next=15,(0,p.e4)(te);case 15:e.next=3;break;case 17:case"end":return e.stop()}}),e)}))),Y.apply(this,arguments)}function $(e){return!!e.infoFor3D&&!!e.url}function ee(e){var t,r=e.infoFor3D,n=null!==(t=(0,x.S0)("model/gltf-binary",r.supportedFormats))&&void 0!==t?t:(0,x.Ow)("glb",r.supportedFormats);if(!n)throw new u.Z("".concat(e.type,"-layer:upload-failure"),"Layer does not support glb.",new Error);return n}var te=1e3}}]);
//# sourceMappingURL=5532.d533d80c.chunk.js.map